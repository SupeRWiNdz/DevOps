- name: Check if Docker is installed
  command: which docker
  register: docker_installed
  failed_when: false
  changed_when: false

- name: Check if Docker Compose is available
  command: docker compose version
  register: compose_available
  failed_when: false
  changed_when: false

- name: Debug Docker status
  debug:
    msg: |
      Docker installed: {{ docker_installed.rc == 0 }}
      Docker Compose available: {{ compose_available.rc == 0 }}

- name: Check docker-compose file exists
  stat:
    path: "/home/danya/projects/DevOps/docker-compose.yml"
  register: compose_file

- name: Debug compose file
  debug:
    msg: "Compose file exists: {{ compose_file.stat.exists }}"

- name: Fail if prerequisites not met
  fail:
    msg: |
      Prerequisites not met:
      - Docker installed: {{ docker_installed.rc == 0 }}
      - Compose available: {{ compose_available.rc == 0 }}
      - Compose file exists: {{ compose_file.stat.exists }}
  when: >
    docker_installed.rc != 0 or 
    compose_available.rc != 0 or 
    not compose_file.stat.exists

- name: Start docker-compose
  command: 
    cmd: docker compose -f "docker-compose.yml" up -d
    chdir: "/home/danya/projects/DevOps"
  register: compose_result

- name: Debug compose result
  debug:
    var: compose_result

- name: Check running containers
  command: docker ps
  register: running_containers

- name: Show running containers
  debug:
    msg: "Running containers: {{ running_containers.stdout_lines }}"